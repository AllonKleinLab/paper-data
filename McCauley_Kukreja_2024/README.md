OVERVIEW OF WHAT IS INSIDE THIS FOLDER:

This folder contains codes for specific analyses in McCauley/Kukreja et. al. 2024 Cell systems manuscript.
The folder in divided into:

1. data: This contains data used in the codes and also some data files generated by the codes. The data folder has a subfolder called anndata_objects in which the user should place anndata files needed for the codes. These are single-cell data files (in python's anndata object format) collected for and published in this manuscript with all relevant metadata. Their GEO IDs are GSE246368 (all_indrops_data.h5ad) and GSE246441 (all_10x_data.h5ad). The codes also require 4 published disease datasets that are referenced in the manuscript. Their GEO IDs are: GSE135893(adata_ipf1_epithelial_processed.h5ad), GSE136831 (adata_ipf2_epithelial_processed.h5ad, adata_copd_epithelial_processed.h5ad) and GSE171524 (adata_covid_epithelial_processed.h5ad). We used these disease datasets to predict signaling induction in disease. 
All of these six anndata objects can also be found in one place on the zenodo repository, doi: 10.5281/zenodo.10602177

2. notebooks: This contains python jupyter notebooks under 3 folders:
	a. fig1_2_analyses: It contains notebooks for analyzing cell type abundances, calculating composite gene score and making related plots, and control neighbor analysis (Fig. 1G). These notebooks generate analyses and plot for many of the panels in Figures 1 and 2.
	b. fig3_program_analyses: It contains notebook used to generate plots for gene expression program analyses for Figure 3.
	c. fig5_disease_analyses: It contains notebooks for calculating expression of signaling programs in disease datasets and generating plots in Figure 5.

3. figures: This folder contains figures generated by running notebooks in the notebook folder.

4. helper_functions: This folder contains a python file called helper_functions_py3.py that contains functions that have been used for various analyses done in the manuscript and called in the jupyter notebooks shared here.

5. environment_files: I have cloned my conda environments - both the base environment (base.yml) installed in my laptop that I used for analyzing data and the environment in which I wrote all the code for this paper (scanpy.yml). You can create these environments using the provided yaml files to stay consistent with versions in case you want to reproduce some of the paper figures or analyses. I have also provided a list of packages downloaded through pip (pip_packages.txt) in case they are not covered in the conda environment.

PREPROCESSING:
All the data was preprocessed and all cells annotated as described in McCauley/Kukreja et. al. 2024 method sections:
Single-cell RNA sequencing read processing, data filtering and normalization
Dimensionality reduction and donor integration of single cell data
Annotation of untreated hBEC sample scRNA-Seq data
Cell type classification in treated samples
Analyses of additional data collected for OSM and IFNG (Fig. S2B)

Fully annotated data is provided in the data folder.

WHAT EACH NOTEBOOK CONTAINS:
Here I brief what each notebook in each folder contains:

a. fig1_2_analyses:

	control_neighbors_analyses_fig1.ipynb:
	This analysis finds how what fraction of nearest neighbors of a cells in a particular perturbed condition belong to unperturbed data. For the detailed description of the method, refer to McCauley/Kukreja et. al. 2024 manuscript's method section: Fraction control neighbor analyses (Fig. 1G).

	abundance_plots1.ipynb:
	This notebook makes various plots for abundance analyses that leads to generation of Figs. 2F, 2H and S4A.

	abundance_plots2.ipynb:
	This notebook makes various plots for abundance analyses that leads to generation of Figs. 2C, 2D, 2E, 2I, 2J, 2L, S4B, S4C and S4D.

	transitional_states_plots.ipynb:
	This notebook has code to plot various marker gene expression plots - This includes Figs. 2B, 2K and S3A-H.

b. fig3_program_analyses:

	dge_ctrl_perturbations.ipynb:
	This notebook finds number of differentially expressed genes between unperturbed and signaling perturbation conditions across various cell states.
	This analysis was used to generate Fig. 3A and Table S5 for McCauley/Kukreja et. al. 2024 paper.

	plot_program_weights.ipynb:
	This notebook plots program weights, i.e. Fig. 3E for McCauley/Kukreja et. al. 2024 paper.

	usages_across_conditions_heatmap.ipynb:
	This notebook plots usages of cNMF programs in different conditions. It generates plots for Fig. 3C and S5B.

	usage_across_states.ipynb:
	This notebook calculates:
	Usages of control versus perturbation programs in the following conditions: Untreated, BMP4, IFNA, CHIR, TGFB1 and IFNG for the cell states: basal, secretory, multiciliated and rare cells. These calculations generate Fig. 3F of McCauley/Kukreja et. al. 2024 manuscript.
	It also calculates cell type specific expression of various programs in specific signaling conditions (Figs. 3D and S5C).


c. fig5_disease_analyses:

	prog_expr_ipf1.ipynb: 
	This notebook finds out if a particular signaling program is induced in the pulmonary fibrosis disease dataset (GEO ID: GSE135893) by:
	    * calculating program expression in cells from control and disease donors in the dataset.
	    * finding fold change of program expression between disease versus control conditions in different cell types.
	For detailed method description, see manuscript McCauley/Kukreja et. al. 2024 method's section: "Enrichment of signaling programs in disease"

	prog_expr_ipf2.ipynb:
	This notebook finds out if a particular signaling program is induced in the pulmonary fibrosis disease dataset (GEO ID: GSE136831).
	    
	prog_expr_copd.ipynb:
	This notebook finds out if a particular signaling program is induced in the Chronic Obstructive Pulmonary Disease (COPD) dataset (GEO ID: GSE136831).

	prog_expr_covid.ipynb:
	This notebook finds out if a particular signaling program is induced in the COVID 19 lung dataset (GEO ID: GSE171524).

	combining_all_datasets_after_bootstrapping.ipynb:
	This notebook combines the heatmaps of fold change program expression in the 4 disease datasets (see Fig. 5B for citation of the 4 disease datasets).
	    * Fold change program expression for the 4 datasets were calculated in the notebooks: prog_expr_ipf1.ipynb, prog_expr_ipf2.ipynb, prog_expr_copd.ipynb, prog_expr_covid.ipynb.
	    * This notebook just combines the heatmap for all disease datasets for the purpose of plotting Fig. 5C.
	    
	This notebook also plots fold change of immune signaling programs in covid disease dataset for Fig. 5D. 
	    * The fold changes were calculated in the notebook: prog_exp_covid.ipynb. This notebook simply plots these as box plots.

	disease_gene_exp.ipynb:
	This notebook plots expression of top 20 genes of TGFB1 enriched programs in abberant disease cells and rest of the cells. It contains the code for generating Fig. 5F of McCauley/Kukreja et al. 2024 manuscript.

	tgfb_aberrant_vs_rest.ipynb:
	This notebook plots expression of TGFB1 programs (TGFB1-1 and TGFB1-1) in aberrant and non-aberrant disease states for Fig. 5E.

